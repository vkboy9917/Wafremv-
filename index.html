<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WAFREMV OFFLINE</title>

<style>
  <meta name="google-site-verification" content="CZRZIbkBsPT62V1FjO9ZXmtftctGxEiltlx3KRy2EBQ" />
body { margin:0; font-family: Arial; background:#141414; color:white; }

/* LOGIN */
.container { display:flex; justify-content:center; align-items:center; height:100vh; }
.login-box { background:#000; padding:25px; border-radius:10px; width:320px; text-align:center; box-shadow:0 0 20px rgba(0,0,0,0.7);}
.login-box h2 { color:#e50914; }

input { width:90%; padding:10px; margin:8px 0; border-radius:5px; border:none; }
button { width:100%; padding:10px; background:#e50914; color:white; border:none; border-radius:5px; cursor:pointer; }
button:hover { background:#b1060f; }

.link { color:#aaa; cursor:pointer; font-size:14px; margin-top:5px; display:block; }

/* APP */
#app { display:none; }

header {
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:12px;
  background:#000;
}

header h1 { color:#e50914; margin:0; }

.avatar {
  width:35px;
  height:35px;
  border-radius:50%;
  object-fit:cover;
  border:2px solid #e50914;
  cursor:pointer;
}

.search-box {
  padding:8px;
  border-radius:5px;
  border:none;
  width:160px;
}

.videos {
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
}

.video-card {
  background:#000;
  margin:10px;
  padding:10px;
  border-radius:8px;
  width:220px;
  text-align:center;
  box-shadow:0 0 10px rgba(0,0,0,0.6);
}

.video-card h3 {
  margin:5px 0;
  font-size:16px;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

.thumbnail {
  width:100%;
  height:140px;
  background:#333;
  border-radius:6px;
  cursor:pointer;
  object-fit:cover;
}

video {
  width:100%;
  border-radius:6px;
  display:none;
}

/* PANELS */
#menuPanel, #settingsPanel {
  display:none;
  position:fixed;
  background:black;
  padding:20px;
  z-index:1000;
  border-radius:10px;
}

#menuPanel {
  top:0;
  left:0;
  width:230px;
  height:100%;
  border-radius:0;
}

#settingsPanel {
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  width:300px;
}
</style>
</head>

<body>

<!-- LOGIN -->
<div class="container" id="loginScreen">
  <div class="login-box">
    <h2 id="loginTitle">Login</h2>

    <input type="text" id="username" placeholder="Username / Email">
    <input type="password" id="password" placeholder="Password">

    <div id="registerBox" style="display:none;">
      <input type="file" id="profilePic" accept="image/*">
    </div>

    <button onclick="login()" id="loginBtn">Login</button>
    <button onclick="register()" id="registerBtn" style="display:none;">Create Account</button>

    <span class="link" onclick="toggleRegister()" id="toggleText">Create New Account</span>

    <p id="error" style="color:red;"></p>
  </div>
</div>

<!-- APP -->
<div id="app">

<header>
  <div style="display:flex;align-items:center;gap:10px;">
    <span style="font-size:22px;cursor:pointer;" onclick="toggleMenu()">â˜°</span>
    <h1>WAFREMV</h1>
  </div>

  <input class="search-box" id="searchInput" type="text" placeholder="Search..." oninput="displayVideos()">

  <img id="userAvatar" class="avatar" onclick="openSettings()">
</header>

<div class="upload-section" id="uploadSection" style="display:none;text-align:center;margin:15px;">
  <input type="text" id="movieName" placeholder="Movie Name">
  <input type="file" id="videoUpload" accept="video/*">
  <button onclick="uploadVideo()">Upload Movie</button>
</div>

<div class="videos" id="videoList"></div>

</div>

<!-- MENU -->
<div id="menuPanel">
  <h3 style="color:#e50914;">Menu</h3>
  <p style="cursor:pointer;" onclick="openSettings()">âš™ Settings</p>
  <p style="cursor:pointer;" onclick="showHistory()">ðŸ“œ Watch History</p>
  <p style="cursor:pointer;" onclick="logout()">ðŸšª Logout</p>
</div>

<!-- SETTINGS -->
<div id="settingsPanel">
  <h3 style="color:#e50914;">Profile Settings</h3>
  <input id="newUser" placeholder="New Username">
  <input id="newPass" type="password" placeholder="New Password">
  <input type="file" id="newPic" accept="image/*">
  <button onclick="saveSettings()">Save</button>
  <button style="background:gray;margin-top:5px;" onclick="closeSettings()">Close</button>
</div>

<script>
// ADMIN
const ADMIN_USER = "gameplay895767@gmail.com";
const ADMIN_PASS = "vkboy9918";

let currentUser = null;
let isAdmin = false;

// USERS
let users = JSON.parse(localStorage.getItem("users") || "[]");

// TOGGLE REGISTER
function toggleRegister(){
  const box = document.getElementById("registerBox");
  const loginBtn = document.getElementById("loginBtn");
  const regBtn = document.getElementById("registerBtn");
  const title = document.getElementById("loginTitle");
  const toggle = document.getElementById("toggleText");

  if(box.style.display === "none"){
    box.style.display = "block";
    loginBtn.style.display = "none";
    regBtn.style.display = "block";
    title.innerText = "Create Account";
    toggle.innerText = "Back to Login";
  } else {
    box.style.display = "none";
    loginBtn.style.display = "block";
    regBtn.style.display = "none";
    title.innerText = "Login";
    toggle.innerText = "Create New Account";
  }
}

// REGISTER
function register(){
  const user = username.value.trim();
  const pass = password.value.trim();
  const picFile = profilePic.files[0];

  if(!user || !pass) return error.innerText = "Fill all fields";

  if(users.find(u => u.user === user)) {
    error.innerText = "User already exists";
    return;
  }

  const reader = new FileReader();
  reader.onload = function(){
    users.push({ user, pass, pic: reader.result });
    localStorage.setItem("users", JSON.stringify(users));
    alert("Account Created!");
    toggleRegister();
  };
  if(picFile) reader.readAsDataURL(picFile);
  else {
    users.push({ user, pass, pic: "" });
    localStorage.setItem("users", JSON.stringify(users));
    alert("Account Created!");
    toggleRegister();
  }
}

// LOGIN
function login(){
  const user = username.value.trim();
  const pass = password.value.trim();

  if(user === ADMIN_USER && pass === ADMIN_PASS){
    isAdmin = true;
    currentUser = user;
    startApp("");
    return;
  }

  const found = users.find(u => u.user === user && u.pass === pass);
  if(!found) return error.innerText = "Invalid Login";

  isAdmin = false;
  currentUser = user;
  startApp(found.pic);
}

// START
function startApp(pic){
  loginScreen.style.display = "none";
  app.style.display = "block";
  uploadSection.style.display = isAdmin ? "block" : "none";
  userAvatar.src = pic || "https://dummyimage.com/100x100/000/fff&text=U";
  displayVideos();
}

// LOGOUT
function logout(){
  location.reload();
}

// MENU
function toggleMenu(){
  menuPanel.style.display = menuPanel.style.display === "block" ? "none" : "block";
}

// SETTINGS
function openSettings(){
  settingsPanel.style.display = "block";
  menuPanel.style.display = "none";
}
function closeSettings(){
  settingsPanel.style.display = "none";
}
function saveSettings(){
  const newU = newUser.value.trim();
  const newP = newPass.value.trim();
  const newPic = newPicInput = document.getElementById("newPic").files[0];

  if(isAdmin){
    alert("Admin credentials fixed");
    return;
  }

  let userObj = users.find(u => u.user === currentUser);

  if(newU) userObj.user = newU;
  if(newP) userObj.pass = newP;

  if(newPic){
    const reader = new FileReader();
    reader.onload = function(){
      userObj.pic = reader.result;
      localStorage.setItem("users", JSON.stringify(users));
      alert("Updated. Login again.");
      logout();
    };
    reader.readAsDataURL(newPic);
  } else {
    localStorage.setItem("users", JSON.stringify(users));
    alert("Updated. Login again.");
    logout();
  }
}

// VIDEOS
function uploadVideo(){
  const name = movieName.value.trim();
  const file = videoUpload.files[0];
  if(!name || !file) return alert("Enter name & select video");

  const reader = new FileReader();
  reader.onload = function(){
    let vids = JSON.parse(localStorage.getItem("videos") || "[]");
    vids.push({ id: Date.now(), name, data: reader.result });
    localStorage.setItem("videos", JSON.stringify(vids));
    displayVideos();
  };
  reader.readAsDataURL(file);
}

// DISPLAY
function displayVideos(){
  const list = document.getElementById("videoList");
  const search = searchInput.value.toLowerCase();
  list.innerHTML = "";

  const vids = JSON.parse(localStorage.getItem("videos") || "[]");
  const filtered = vids.filter(v => v.name.toLowerCase().includes(search));

  if(!filtered.length){
    list.innerHTML = "<p>No movies found</p>";
    return;
  }

  filtered.forEach(v => {
    const card = document.createElement("div");
    card.className = "video-card";

    const h = document.createElement("h3");
    h.innerText = v.name;

    const img = document.createElement("img");
    img.className = "thumbnail";
    img.src = "https://dummyimage.com/400x200/000/fff&text=Play";

    const vid = document.createElement("video");
    vid.src = v.data;
    vid.controls = true;

    img.onclick = () => {
      img.style.display = "none";
      vid.style.display = "block";
      vid.play();
    };

    vid.onpause = () => {
      saveHistory(v.name);
    };

    card.append(h, img, vid);

    if(isAdmin){
      const del = document.createElement("button");
      del.innerText = "Delete";
      del.onclick = () => deleteVideo(v.id);
      card.appendChild(del);
    }

    list.appendChild(card);
  });
}

// DELETE
function deleteVideo(id){
  let vids = JSON.parse(localStorage.getItem("videos") || "[]");
  vids = vids.filter(v => v.id !== id);
  localStorage.setItem("videos", JSON.stringify(vids));
  displayVideos();
}

// HISTORY
function saveHistory(name){
  let h = JSON.parse(localStorage.getItem("history_" + currentUser) || "[]");
  if(!h.includes(name)) h.push(name);
  localStorage.setItem("history_" + currentUser, JSON.stringify(h));
}

function showHistory(){
  let h = JSON.parse(localStorage.getItem("history_" + currentUser) || "[]");
  alert("Watch History:\n\n" + (h.join("\n") || "No history"));
}
</script>

</body>
</html>
